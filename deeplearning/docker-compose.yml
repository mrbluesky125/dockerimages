version: "2"

volumes:
  nvidia_driver_367.35:
      external: true

services:
    deeplearning_${DEEPLEARNING_NAME}:
        build: .
        image: deeplearning_${DEEPLEARNING_NAME}_image
        network_mode: "bridge"
        container_name: deeplearning_${DEEPLEARNING_NAME}
        env_file: passwd.env
        restart: always
        environment:
            - CONTAINER=DEEPLEARNING
        cpuset: 0-16
        working_dir: /root/workspace
        devices:
            - /dev/nvidiactl
            - /dev/nvidia-uvm
            - /dev/nvidia-uvm-tools
            - /dev/nvidia0
            - /dev/nvidia1
            - /dev/nvidia2
            - /dev/nvidia3
        volumes:
            - nvidia_driver_367.35:/usr/local/nvidia:ro
            - /srv/docker/volumes/dlmlabor/workspaces/deeplearning_${DEEPLEARNING_NAME}:/root/workspace
            - /srv/docker/volumes/dlmlabor/vorlesung:/root/vorlesung:ro
            - /srv/docker/volumes/dlmlabor/shared:/root/shared:ro
        ports:
            - ${DEEPLEARNING_PORT}:3389/tcp
